<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Augustus Pendleton">
<meta name="dcterms.date" content="2024-07-15">

<title>Making a Map in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Lesson_Plan_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lesson_Plan_files/libs/quarto-html/quarto.js"></script>
<script src="Lesson_Plan_files/libs/quarto-html/popper.min.js"></script>
<script src="Lesson_Plan_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lesson_Plan_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lesson_Plan_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lesson_Plan_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Lesson_Plan_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lesson_Plan_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lesson_Plan_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#recap-of-last-week" id="toc-recap-of-last-week" class="nav-link active" data-scroll-target="#recap-of-last-week">Recap of Last Week</a></li>
  <li><a href="#todays-goals" id="toc-todays-goals" class="nav-link" data-scroll-target="#todays-goals">Today’s Goals</a></li>
  <li><a href="#downloading-data" id="toc-downloading-data" class="nav-link" data-scroll-target="#downloading-data">Downloading Data</a></li>
  <li><a href="#loading-necessary-libraries" id="toc-loading-necessary-libraries" class="nav-link" data-scroll-target="#loading-necessary-libraries">Loading Necessary Libraries</a></li>
  <li><a href="#reading-in-lake-ontario-outline" id="toc-reading-in-lake-ontario-outline" class="nav-link" data-scroll-target="#reading-in-lake-ontario-outline">Reading in Lake Ontario Outline</a></li>
  <li><a href="#reading-in-lake-ontario-bathymetry" id="toc-reading-in-lake-ontario-bathymetry" class="nav-link" data-scroll-target="#reading-in-lake-ontario-bathymetry">Reading in Lake Ontario Bathymetry</a></li>
  <li><a href="#projecting-our-data" id="toc-projecting-our-data" class="nav-link" data-scroll-target="#projecting-our-data">Projecting Our Data</a></li>
  <li><a href="#clipping-our-bathymetry" id="toc-clipping-our-bathymetry" class="nav-link" data-scroll-target="#clipping-our-bathymetry">Clipping Our Bathymetry</a></li>
  <li><a href="#reading-in-our-site-data" id="toc-reading-in-our-site-data" class="nav-link" data-scroll-target="#reading-in-our-site-data">Reading in Our Site Data</a></li>
  <li><a href="#making-a-beautiful-map" id="toc-making-a-beautiful-map" class="nav-link" data-scroll-target="#making-a-beautiful-map">Making a Beautiful Map</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">Further reading:</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Making a Map in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Augustus Pendleton </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July 15, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="recap-of-last-week" class="level2">
<h2 class="anchored" data-anchor-id="recap-of-last-week">Recap of Last Week</h2>
<p>Last week, we learned the basics of spatial data. We covered coordinate systems and projections, and learned the difference between vector and raster data. We also installed packages that we’ll need for today’s lesson, including <code>tidyverse</code>, <code>tmap</code>, <code>sf</code>, and <code>terra</code>.</p>
</section>
<section id="todays-goals" class="level2">
<h2 class="anchored" data-anchor-id="todays-goals">Today’s Goals</h2>
<p>Today, we’re going to go from raw data to a beautiful map. Specifically, we’ll</p>
<ol type="1">
<li><p>Find and download data from governmental sources</p></li>
<li><p>Read in spatial data like shapefiles and GeoTIFFs and create a spatial dataset from a csv</p></li>
<li><p>Learn some geoprocessing steps, like clipping and unionizing</p></li>
<li><p>Create a beautiful sampling map of lake Ontario that includes vector and raster data</p></li>
</ol>
<p>Sound good? Then let’s get started!</p>
</section>
<section id="downloading-data" class="level2">
<h2 class="anchored" data-anchor-id="downloading-data">Downloading Data</h2>
<p>In contrast to analysis done from lab work, spatial data analysis almost always requires data from outside sources - we might want accurate state boundaries, topographical maps, or census data. Luckily, federal agencies have tons of spatial datasets that are freely available to use. But finding the right dataset can be tricky! Today, we’ll use two different government tools to download two datasets: an accurate outline of Lake Ontario, and Lake Ontario’s bathymetry.</p>
<section id="finding-a-lake-ontario-outline" class="level4">
<h4 class="anchored" data-anchor-id="finding-a-lake-ontario-outline">Finding a Lake Ontario Outline</h4>
<p>When I started this project out, I wanted a nice outline of Lake Ontario. So I googled something like “Great Lakes outlines shapefiles”. This brought me to <a href="https://www.sciencebase.gov/catalog/">ScienceBase</a>, a repository of data managed by the USGS. There, they had a dataset called <a href="https://www.sciencebase.gov/catalog/item/530f8a0ee4b0e7e46bd300dd">“Great Lakes and Watersheds Shapefiles”</a>. I scrolled down to find Lake Ontario.</p>
<p><img src="images/hydro_list.png" class="img-fluid"></p>
<p>Ok! This looks a little confusing. We learned last week that shapefiles (.shp) are a common method of storing spatial data. We can see a .shp file at the top of this list…but there’s six other files too? Which is the right file?</p>
<p>As it turns out, all of them. A shapefile will <strong>never</strong> be alone. So we’ll click the hydro_p_LakeOntario.zip at the top to download all of them. Then, you’ll unzip that directory. I’ve already done this in our project’s data folder. If you click into the hydro_p_LakeOntario directory, you’ll see we have seven files total, including the .shp file. When you’re working with shapefiles, you’ll always refer to the .shp file, but it should <em>always</em> live in the same directory as its helper files.</p>
</section>
<section id="finding-lake-ontario-bathymetry" class="level4">
<h4 class="anchored" data-anchor-id="finding-lake-ontario-bathymetry">Finding Lake Ontario Bathymetry</h4>
<p>Next, I wanted a map of the bathymetry of Lake Ontario. Bathymetry is like topography, but underwater - it shows what the lake bottom looks like.</p>
<p>So, I google “Great Lakes Bathymetry”. This brought me to NOAA’s National Centers for Environmental Information page, which manages and distributes NOAA datasets. I scrolled down to Lake Ontario, where there are many different data options. First is a contours shapefile - this will encode the data as a circular contours showing isolines of depths. This would be fine, but I want the option to work with the higher-resolution grid. Instead, I’m going to click ont he GeoTiff, and download it as a .tar.gz file into my data folder. Finally, I unzipped it.</p>
<p>The result is a directory containing three files; the ontario_lld.tif file (which contains the actual raster values) as well as a .tfw and .prj file, containing information on the geographic extent and projection of the grid.</p>
</section>
<section id="epa-water-chemistry-data" class="level4">
<h4 class="anchored" data-anchor-id="epa-water-chemistry-data">EPA Water Chemistry Data</h4>
<p>Finally, if you look in the data folder, you’ll see the EPA_WaterChem.csv file. If we preview this file in Excel, we’ll see it contains information from an EPA sampling cruise on Lake Ontario last May. The EPA visited 31 sites across Lake Ontario, and collected measurements of water quality. Today, we’re working with a small subset of this data - just the surface samples from May, and four water quality measures: Total Nitrogen (TN), Total Phosphorus (TP), Dissolved Organic Carbon (DOC), and Chlorophyll-a. Each site also has its Latitude and Longitude recorded, in decimal degrees.</p>
<p><img src="images/site_preview.png" class="img-fluid"></p>
</section>
</section>
<section id="loading-necessary-libraries" class="level2">
<h2 class="anchored" data-anchor-id="loading-necessary-libraries">Loading Necessary Libraries</h2>
<p>Next, let’s load the libraries we’ll use for our data analysis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmaptools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Please check the output of these commands carefully. After we load sf, we should see a message like</p>
<p><code>Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0..</code></p>
<p>If you have a different warning message, please let Gus know.</p>
<p>Otherwise, you may get some warnings like <code>The following object is masked...</code> or <code>Registered S3 method overwritten...</code> - these are totally fine and not a cause of concern!</p>
</section>
<section id="reading-in-lake-ontario-outline" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-lake-ontario-outline">Reading in Lake Ontario Outline</h2>
<p>Next, let’s read in our Lake Ontario outline. To do this, we’ll use the <code>st_read</code> function from the <code>sf</code> package.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>outline <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/hydro_p_LakeOntario/hydro_p_LakeOntario.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `hydro_p_LakeOntario' from data source 
  `/Users/augustuspendleton/Desktop/Coding/Hacky_Hour_Tutorials/20240716_Spatial_R_Day2/data/hydro_p_LakeOntario/hydro_p_LakeOntario.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 2 features and 7 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: -79.78268 ymin: 43.18171 xmax: -76.05991 ymax: 44.23282
Geodetic CRS:  Geographic</code></pre>
</div>
</div>
<p>Let’s look at the message it’s provided us. We see it recognized that it’s an “ESRI Shapefile”. In the language of <code>sf</code> (which stands for “simple features”), this is a collection of 2 features (or geometries) with 7 fields (attributes). It’s a polygon geometry, with a geographic coordinate reference system (CRS). We can also see that the “bounding box” (spatial extent) of our object is in degrees.</p>
<p>We can use tmap to take a quick look at this polygon set. You’ll notice that <code>tmap</code> use a grammar similar to <code>ggplot</code>, where we first use <code>tm_shape</code> to reference our data (like calling <code>ggplot()</code>) and then add geoms using a plus sign and the function <code>tm_polygons</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(outline) <span class="sc">+</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson_Plan_files/figure-html/glimpse-outline-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>That looks like Ontario (yay!). And now we understand why our data has two features - there’s one polygon for the Canadian side, and another for the US side. Going forward, I don’t want that line in the center, so I’m going to merge these two polygons into one using the command <code>st_union</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>outline_union <span class="ot">&lt;-</span> <span class="fu">st_union</span>(outline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see if that worked</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(outline_union) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson_Plan_files/figure-html/glimpse-outline-union-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Much better! Now there’s only one feature.</p>
</section>
<section id="reading-in-lake-ontario-bathymetry" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-lake-ontario-bathymetry">Reading in Lake Ontario Bathymetry</h2>
<p>Next, let’s read in our Ontario bathymetry using the <code>rast</code> function from <code>terra.</code> We’ll also check its coordinate reference system while we’re at it.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>bathymetry <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data/ontario_lld/ontario_lld.tif"</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(bathymetry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD83 
  wkt:
GEOGCRS["NAD83",
    DATUM["North American Datum 1983",
        ELLIPSOID["GRS 1980",6378137,298.257222101004,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4269]]</code></pre>
</div>
</div>
<p>If you look in the environment pane, you’ll see that <code>terra</code> stores data as something called a SpatRaster (for spatial raster). Our reference system is also geographic, and also relies on the NAD83 datum. Let’s check to see what our raster looks like.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(bathymetry) <span class="sc">+</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson_Plan_files/figure-html/glimpse-raster-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>underwater_bathymetry <span class="ot">&lt;-</span> <span class="fu">clamp</span>(bathymetry, <span class="at">upper =</span> <span class="dv">0</span>, <span class="at">values =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Okay! That is a definite start. When we ran this command, we got some warning messages; first that our SpatRaster object was “downsampled”, This is okay - it means that <code>tmap</code> reduced the resolution of our dataset to match our computer’s resolution. It also warned us that since our data has both positive and negative values (elevation, in this case), it set the midpoint of our color scale to 0. This is also fine; we’re going to deal with this in a sec.</p>
<p>The major problem we notice is that this raster doesn’t just contain bathymetry for Lake Ontario; it also contains the elevation of the surrounding landscape as well. We don’t want this, so we need to remove these values. We’ll do this using a geoprocessing tool called “clipping”. First, however, we’re going to project our data.</p>
</section>
<section id="projecting-our-data" class="level2">
<h2 class="anchored" data-anchor-id="projecting-our-data">Projecting Our Data</h2>
<p>In our next steps, we’re going to use our Ontario outline to “clip” values in our Lake Ontario bathymetry. However, when we combine or apply any two spatial sets together, <strong>they should always have matching coordinate reference systems</strong>. We can check if their reference systems are the same:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(outline_union)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: Geographic 
  wkt:
GEOGCRS["Geographic",
    DATUM["North American Datum 1983",
        ELLIPSOID["GRS 1980",6378137,298.257222101,
            LENGTHUNIT["metre",1]],
        ID["EPSG",6269]],
    PRIMEM["&lt;custom&gt;",0,
        ANGLEUNIT["Degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["longitude",east,
            ORDER[1],
            ANGLEUNIT["Degree",0.0174532925199433]],
        AXIS["latitude",north,
            ORDER[2],
            ANGLEUNIT["Degree",0.0174532925199433]]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(bathymetry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD83 
  wkt:
GEOGCRS["NAD83",
    DATUM["North American Datum 1983",
        ELLIPSOID["GRS 1980",6378137,298.257222101004,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4269]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(outline_union) <span class="sc">==</span> <span class="fu">st_crs</span>(bathymetry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>We see that their projections aren’t identical; while they both use the NAD83 datum, their EPSG codes are different. An EPSG code is a succinct identifier for different projections. Our outline had an EPSG code of 6269, while our bathymetry had an EPSG code of 4269. These datasets won’t be able to interact until we make sure they have the same reference system.</p>
<p>Additionally, when we make maps, recall that we should project geographic (angular) coordinates to 2D (cartesian) coordinates, in a way that best limits distortion. As such, this seems like a good time to project our data into the projection we’ll use when mapping. Today, we’ll use a projection with <a href="https://epsg.io/3174">EPSG code 3174</a>, which is a good projection to limit distortion across the Great Lakes. We’ll use the function <code>st_transform</code> to project vector data, and <code>project</code> to project our raster.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>proj_outline <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(outline_union, <span class="at">crs =</span> <span class="st">"EPSG:3174"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>proj_bathymetry <span class="ot">&lt;-</span> <span class="fu">project</span>(bathymetry, <span class="st">"EPSG:3174"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(proj_outline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:3174 
  wkt:
PROJCRS["NAD83 / Great Lakes Albers",
    BASEGEOGCRS["NAD83",
        DATUM["North American Datum 1983",
            ELLIPSOID["GRS 1980",6378137,298.257222101,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["degree",0.0174532925199433]],
        ID["EPSG",4269]],
    CONVERSION["Great Lakes Albers",
        METHOD["Albers Equal Area",
            ID["EPSG",9822]],
        PARAMETER["Latitude of false origin",45.568977,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8821]],
        PARAMETER["Longitude of false origin",-84.455955,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8822]],
        PARAMETER["Latitude of 1st standard parallel",42.122774,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8823]],
        PARAMETER["Latitude of 2nd standard parallel",49.01518,
            ANGLEUNIT["degree",0.0174532925199433],
            ID["EPSG",8824]],
        PARAMETER["Easting at false origin",1000000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8826]],
        PARAMETER["Northing at false origin",1000000,
            LENGTHUNIT["metre",1],
            ID["EPSG",8827]]],
    CS[Cartesian,2],
        AXIS["easting (X)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["northing (Y)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Basin-wide mapping and analysis."],
        AREA["Canada and United States (USA) - Great Lakes basin."],
        BBOX[40.99,-93.17,50.74,-74.47]],
    ID["EPSG",3174]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(proj_outline) <span class="sc">==</span> <span class="fu">st_crs</span>(proj_bathymetry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
<p>We see that our data are now projected to EPSG 3174, “Great Lakes Albers”, and that both our outline and our bathymetry have matching reference systems.</p>
</section>
<section id="clipping-our-bathymetry" class="level2">
<h2 class="anchored" data-anchor-id="clipping-our-bathymetry">Clipping Our Bathymetry</h2>
<p>Next, we want to “clip” our raster, such that only values inside our Lake Ontario outline are kept. We’ll use the function <code>mask</code> from <code>terra</code> to do so.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>clip_bathymetry <span class="ot">&lt;-</span> <span class="fu">mask</span>(proj_bathymetry, <span class="fu">vect</span>(proj_outline))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s confirm that worked.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(clip_bathymetry) <span class="sc">+</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson_Plan_files/figure-html/glimpse-clipped-bathymetry-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Much better! However, we do notice that there are still a few bits of elevation above lake level, specifically around the shoreline and on a few islands. Let’s trim those out, using a function called <code>clamp</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>clamp_bathymetry <span class="ot">&lt;-</span> <span class="fu">clamp</span>(clip_bathymetry, <span class="at">upper =</span> <span class="dv">0</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>final_bathymetry <span class="ot">&lt;-</span> clamp_bathymetry <span class="sc">*</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(final_bathymetry) <span class="sc">+</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson_Plan_files/figure-html/clamp-bathymetry-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Awesome! You’ll see I also added a line to convert our bathymetry from negative values (i.e.&nbsp;“elevation”) to positive values (i.e.&nbsp;“depth”).</p>
</section>
<section id="reading-in-our-site-data" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-our-site-data">Reading in Our Site Data</h2>
<p>Next, let’s read in the data collected by the EPA.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>site_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/EPA_WaterChem.csv"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(site_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 31
Columns: 7
$ Site      &lt;dbl&gt; 8, 9, 12, 19, 18, 17, 29, 28, 27, 33, 34, 35, 43, 42, 41, 40…
$ TN        &lt;dbl&gt; 640, 555, 465, 475, 505, 492, 521, 506, 501, 473, 479, 441, …
$ TP        &lt;dbl&gt; 7.36, 7.67, 4.39, 6.63, 4.38, 4.67, 3.71, 4.57, 6.09, 6.64, …
$ DOC       &lt;dbl&gt; 2.44, 2.44, 2.38, 2.49, 2.42, 2.44, 2.28, 2.45, 2.35, 2.51, …
$ Chl_A     &lt;dbl&gt; 2.22, 2.48, 2.53, 3.36, 1.78, 0.55, 0.79, 1.33, 2.52, 3.44, …
$ Latitude  &lt;dbl&gt; 43.6231, 43.5867, 43.5033, 43.3836, 43.3036, 43.2247, 43.818…
$ Longitude &lt;dbl&gt; -79.4528, -79.3950, -79.3531, -79.2853, -79.2781, -79.2719, …</code></pre>
</div>
</div>
<p>So we’ve read this data in as a <em>dataframe</em>. R doesn’t know that it has spatial data yet! We need to convert this dataframe to a spatial object using the <code>st_as_sf</code> function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>site_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(site_df, </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"Longitude"</span>, <span class="st">"Latitude"</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>site_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 31 features and 5 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -79.4528 ymin: 43.2247 xmax: -76.51833 ymax: 43.9497
CRS:           NA
# A tibble: 31 × 6
    Site    TN    TP   DOC Chl_A           geometry
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;            &lt;POINT&gt;
 1     8   640  7.36  2.44  2.22 (-79.4528 43.6231)
 2     9   555  7.67  2.44  2.48  (-79.395 43.5867)
 3    12   465  4.39  2.38  2.53 (-79.3531 43.5033)
 4    19   475  6.63  2.49  3.36 (-79.2853 43.3836)
 5    18   505  4.38  2.42  1.78 (-79.2781 43.3036)
 6    17   492  4.67  2.44  0.55 (-79.2719 43.2247)
 7    29   521  3.71  2.28  0.79   (-78.87 43.8183)
 8    28   506  4.57  2.45  1.33  (-78.8533 43.775)
 9    27   501  6.09  2.35  2.52     (-78.83 43.69)
10    33   473  6.64  2.51  3.44 (-78.8144 43.5964)
# ℹ 21 more rows</code></pre>
</div>
</div>
<p>Now we have another simple feature collection. This time it’s a POINT collection, with 31 features (points) with 5 fields (attributes). You’ll notive it looks like a dataframe, and has the same columns as our dataframe, but there is a special column called <code>geometry</code> that contains the coordinates of each feature. We also see that there is no CRS. R has no idea what reference system these coordinates are actually in, because we never told it. We can set the CRS using <code>st_set_crs</code> function. In this case, we’ll use EPSG:4326, which is the WGS84 angular coordinate system usually reported by GPS.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>site_sf_crs <span class="ot">&lt;-</span> <span class="fu">st_set_crs</span>(site_sf,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"EPSG:4326"</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>site_sf_crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 31 features and 5 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -79.4528 ymin: 43.2247 xmax: -76.51833 ymax: 43.9497
Geodetic CRS:  WGS 84
# A tibble: 31 × 6
    Site    TN    TP   DOC Chl_A           geometry
 * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;        &lt;POINT [°]&gt;
 1     8   640  7.36  2.44  2.22 (-79.4528 43.6231)
 2     9   555  7.67  2.44  2.48  (-79.395 43.5867)
 3    12   465  4.39  2.38  2.53 (-79.3531 43.5033)
 4    19   475  6.63  2.49  3.36 (-79.2853 43.3836)
 5    18   505  4.38  2.42  1.78 (-79.2781 43.3036)
 6    17   492  4.67  2.44  0.55 (-79.2719 43.2247)
 7    29   521  3.71  2.28  0.79   (-78.87 43.8183)
 8    28   506  4.57  2.45  1.33  (-78.8533 43.775)
 9    27   501  6.09  2.35  2.52     (-78.83 43.69)
10    33   473  6.64  2.51  3.44 (-78.8144 43.5964)
# ℹ 21 more rows</code></pre>
</div>
</div>
<p>Finally, let’s project our data to the same Great Lakes projection that we used for our outline and bathymetry.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>proj_site_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(site_sf_crs,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">crs =</span> <span class="st">"EPSG:3174"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>proj_site_sf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 31 features and 5 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 1403076 ymin: 752678.1 xmax: 1639774 ymax: 840212.1
Projected CRS: NAD83 / Great Lakes Albers
# A tibble: 31 × 6
    Site    TN    TP   DOC Chl_A           geometry
 * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;        &lt;POINT [m]&gt;
 1     8   640  7.36  2.44  2.22 (1403076 795972.1)
 2     9   555  7.67  2.44  2.48 (1407981 792222.7)
 3    12   465  4.39  2.38  2.53 (1411943 783178.3)
 4    19   475  6.63  2.49  3.36 (1418265 770242.5)
 5    18   505  4.38  2.42  1.78 (1419419 761401.5)
 6    17   492  4.67  2.44  0.55 (1420486 752678.1)
 7    29   521  3.71  2.28  0.79 (1448449 820727.2)
 8    28   506  4.57  2.45  1.33   (1450124 816015)
 9    27   501  6.09  2.35  2.52   (1452654 806713)
10    33   473  6.64  2.51  3.44 (1454637 796414.7)
# ℹ 21 more rows</code></pre>
</div>
</div>
</section>
<section id="making-a-beautiful-map" class="level2">
<h2 class="anchored" data-anchor-id="making-a-beautiful-map">Making a Beautiful Map</h2>
<p>We now have all of our data cleaned up, in a matching crs, and ready to be mapped. Let’s first work to build a beautiful site map, showing the sites that we sampled. <code>tmap</code> works similarly to ggplot, where you build the plot up by layers, and then can use theme and layout arguments to adjust the visualization. What’s different is that in tmap, each layer will typically involve a new dataset. So for instance, below, I’ll use the <code>tm_shape</code> command to show that I’m bringing in a new dataset.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(final_bathymetry) <span class="sc">+</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>() <span class="sc">+</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(proj_outline) <span class="sc">+</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="co"># Remove fill, so that we can see the bathymetry</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson_Plan_files/figure-html/first-map-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>We can improve this basemap - let’s clean up the legend and adjust our palette slightly.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(final_bathymetry) <span class="sc">+</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_raster</span>(<span class="at">col.scale =</span> <span class="fu">tm_scale</span>(<span class="at">values =</span> <span class="st">"Blues"</span>),</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">"Depth (m)"</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">frame =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">orientation =</span> <span class="st">"landscape"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">position =</span> <span class="fu">tm_pos_out</span>(<span class="st">"center"</span>,<span class="st">"bottom"</span>))) <span class="sc">+</span> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(proj_outline) <span class="sc">+</span> </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson_Plan_files/figure-html/second-map-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>The commands for tmap can feel a bit overwhelming at first! I highly recommend <a href="https://mtennekes.github.io/tmap4/">this resource</a> as a good description for now; once tmap v4.0 is released, I’m hopeful for good, updated documentation!</p>
<p>This is looking good! Let’s save it as a basemap, and then we’ll add our site locations on top.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>basemap <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(final_bathymetry) <span class="sc">+</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>             <span class="fu">tm_raster</span>(<span class="at">col.scale =</span> <span class="fu">tm_scale</span>(<span class="at">values =</span> <span class="st">"Blues"</span>),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">col.legend =</span> <span class="fu">tm_legend</span>(<span class="at">title =</span> <span class="st">"Depth (m)"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">frame =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">orientation =</span> <span class="st">"landscape"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">position =</span> <span class="fu">tm_pos_out</span>(<span class="st">"center"</span>,<span class="st">"bottom"</span>))) <span class="sc">+</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">tm_shape</span>(proj_outline) <span class="sc">+</span> </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">tm_polygons</span>(<span class="at">fill =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>basemap <span class="sc">+</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(proj_site_sf) <span class="sc">+</span> </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_symbols</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson_Plan_files/figure-html/third-map-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Now, we can see all of our sampling locations. Let’s adjust the fill and color, and add the site number as text inside.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>basemap <span class="sc">+</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(proj_site_sf) <span class="sc">+</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_symbols</span>(<span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="at">text =</span> <span class="st">"Site"</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson_Plan_files/figure-html/fourth-map-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>That’s a start! Let’s see if we can get it looking a little cleaner by those overlapping points, by messing around with the sizes and outline. I also dislike having a frame around the map; let’s remove it.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>basemap <span class="sc">+</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(proj_site_sf) <span class="sc">+</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_symbols</span>(<span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="at">text =</span> <span class="st">"Site"</span>,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson_Plan_files/figure-html/fifth-map-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Okay! Now let’s add some common map elements, including a compass rose and a scale bar.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>basemap <span class="sc">+</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(proj_site_sf) <span class="sc">+</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_symbols</span>(<span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span> </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_text</span>(<span class="at">text =</span> <span class="st">"Site"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">position =</span> <span class="fu">tm_pos_in</span>(<span class="st">"left"</span>,<span class="st">"top"</span>),</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">text.size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scalebar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>,<span class="dv">50</span>),</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">tm_pos_out</span>(<span class="at">cell.h =</span> <span class="st">"center"</span>, <span class="at">cell.v =</span> <span class="st">"bottom"</span>,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">pos.h =</span> <span class="st">"center"</span>, <span class="at">pos.v =</span> <span class="st">"bottom"</span>),</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">text.size =</span> .<span class="dv">75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Lesson_Plan_files/figure-html/sixth-map-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>I think that looks really nice! Let’s save it as an image that we can share.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>final_map <span class="ot">&lt;-</span> basemap <span class="sc">+</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">tm_shape</span>(proj_site_sf) <span class="sc">+</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">tm_symbols</span>(<span class="at">fill =</span> <span class="st">"white"</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">col =</span> <span class="cn">NA</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span> </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>               <span class="fu">tm_text</span>(<span class="at">text =</span> <span class="st">"Site"</span>,</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>               <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>               <span class="fu">tm_compass</span>(<span class="at">position =</span> <span class="fu">tm_pos_in</span>(<span class="st">"left"</span>,<span class="st">"top"</span>),</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">text.size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>               <span class="fu">tm_scalebar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">25</span>,<span class="dv">50</span>),</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">position =</span> <span class="fu">tm_pos_out</span>(<span class="at">cell.h =</span> <span class="st">"center"</span>, <span class="at">cell.v =</span> <span class="st">"bottom"</span>,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">pos.h =</span> <span class="st">"center"</span>, <span class="at">pos.v =</span> <span class="st">"bottom"</span>),</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">text.size =</span> .<span class="dv">75</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>             </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_save</span>(final_map, </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">filename =</span> <span class="st">"Site_Map.png"</span>, </span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">units =</span> <span class="st">"in"</span>,</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">width =</span> <span class="dv">7</span>,</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">height =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And here’s our final map!</p>
<p><img src="Site_Map.png" class="img-fluid"> ## Challenges:</p>
<ol type="1">
<li><p>Change the fill of symbols to reflect concentrations of different environmental variables. What trends do you see?</p></li>
<li><p>Make multiple maps and use <code>tmap_arrange</code> to combine and export them.</p></li>
<li><p>Find a new spatial data from a federal data source (I’d check out NOAA NCEI, USGS, or the EPA). Download, import, and map the data.</p></li>
</ol>
</section>
<section id="further-reading" class="level2">
<h2 class="anchored" data-anchor-id="further-reading">Further reading:</h2>
<p><a href="https://www.paulamoraga.com/book-spatial/types-of-spatial-data.html">Excellent overview of spatial data in R</a></p>
<p><a href="https://mtennekes.github.io/tmap4/">tmap overview</a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>